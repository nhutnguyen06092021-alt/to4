<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Kh√¥ng Gian H·ªçc T·∫≠p - T·∫øt 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Be+Vietnam+Pro:wght@300;400;600;700;900&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<style>
    :root {
        /* B·ªô m√†u T·∫øt r·ª±c r·ª° h∆°n */
        --tet-bg-dark: #3a0000;  
        --tet-red: #d00000;      
        --tet-gold: #ffcc00;     
        --tet-cream: #fff5d7;    
        
        --glass-surface: rgba(60, 0, 0, 0.6);
        --glass-border: rgba(255, 204, 0, 0.4);
        
        --text-main: #fffbeb;
        --text-muted: #ffbaba;
        
        --font-body: 'Be Vietnam Pro', sans-serif;
        --font-display: 'Dancing Script', cursive;
        --font-num: 'JetBrains Mono', monospace;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
        margin: 0;
        font-family: var(--font-body);
        background-color: var(--tet-bg-dark);
        background-image: 
            radial-gradient(circle at 10% 10%, #660000 0%, transparent 40%),
            radial-gradient(circle at 90% 90%, #880000 0%, transparent 40%);
        color: var(--text-main);
        min-height: 100vh;
        overflow-x: hidden;
        padding-bottom: 80px;
        cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="%23ffcc00"><path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/></svg>'), auto;
    }

    /* === HI·ªÜU ·ª®NG HOA R∆†I === */
    .flower-container {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: 1; overflow: hidden;
    }
    .flower {
        position: absolute; width: 20px; height: 20px;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ff9999'%3E%3Cpath d='M12 2C9 7 4 9 2 12c5 2 7 7 10 10 3-5 8-7 10-10-5-2-7-7-10-10z'/%3E%3C/svg%3E");
        background-size: contain; opacity: 0.8;
    }
    .flower.yellow {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ffcc00'%3E%3Cpath d='M12 2C9 7 4 9 2 12c5 2 7 7 10 10 3-5 8-7 10-10-5-2-7-7-10-10z'/%3E%3C/svg%3E");
    }

    /* === L·ªíNG ƒê√àN (CSS PURE) === */
    .lantern-box {
        position: fixed; top: -10px; z-index: 20;
        transform-origin: top center;
        animation: swing 4s infinite ease-in-out;
    }
    .lantern-box.left { left: 5%; }
    .lantern-box.right { right: 5%; animation-delay: 2s; }
    
    .lantern-string { width: 4px; height: 60px; background: #8B0000; margin: 0 auto; }
    .lantern-body {
        width: 80px; height: 100px; background: #D00000;
        border-radius: 30px; position: relative;
        box-shadow: 0 0 20px rgba(255, 0, 0, 0.6);
        display: flex; align-items: center; justify-content: center;
    }
    .lantern-body::before { /* V√†ng trang tr√≠ */
        content: ''; position: absolute; top: 0; width: 60%; height: 100%;
        border-left: 2px solid rgba(255,215,0,0.3);
        border-right: 2px solid rgba(255,215,0,0.3);
    }
    .lantern-text { font-family: 'Dancing Script', cursive; color: #FFD700; font-weight: bold; font-size: 1.5rem; }
    .lantern-tassel { width: 6px; height: 50px; background: #FFD700; margin: 0 auto; position: relative; }
    
    @keyframes swing { 0%, 100% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } }

    /* === PH√ÅO HOA CLICK === */
    .firework-particle {
        position: fixed; width: 6px; height: 6px; border-radius: 50%;
        pointer-events: none; z-index: 9999;
        animation: explode 1s ease-out forwards;
    }
    @keyframes explode {
        0% { transform: scale(1); opacity: 1; }
        100% { transform: translate(var(--tx), var(--ty)); opacity: 0; }
    }

    /* === LAYOUT CH√çNH === */
    .container {
        max-width: 900px; margin: 0 auto; padding: 20px; position: relative; z-index: 10;
        padding-top: 80px; /* Tr√°nh l·ªìng ƒë√®n */
    }

    /* Header */
    header {
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 30px; flex-wrap: wrap; gap: 20px;
        background: rgba(80, 0, 0, 0.5); border-radius: 20px; padding: 15px 25px;
        border: 2px solid var(--glass-border);
        box-shadow: 0 0 30px rgba(255, 0, 0, 0.2);
    }
    
    .logo-area h1 {
        font-family: var(--font-display); font-size: 2.5rem; margin: 0;
        background: linear-gradient(to right, #FFD700, #ff8c00);
        -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
    }
    .greeting { font-size: 1rem; color: var(--tet-cream); display: flex; align-items: center; gap: 8px; margin-top: 5px; font-weight: 600;}

    .user-actions { display: flex; gap: 10px; }
    .icon-btn {
        background: rgba(255,200,0,0.1); border: 1px solid var(--tet-gold);
        color: var(--tet-gold); width: 45px; height: 45px; border-radius: 50%;
        display: flex; align-items: center; justify-content: center; cursor: pointer;
        transition: 0.3s; font-size: 1.1rem;
    }
    .icon-btn:hover, .icon-btn.active { background: var(--tet-gold); color: #8B0000; transform: scale(1.1); box-shadow: 0 0 20px var(--tet-gold); }

    /* === DASHBOARD === */
    .dashboard-grid {
        display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;
    }
    @media (max-width: 600px) { .dashboard-grid { grid-template-columns: 1fr; } }

    .widget-card {
        background: var(--glass-surface);
        backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        border: 1px solid var(--glass-border);
        border-radius: 20px; padding: 20px;
        position: relative; overflow: hidden; transition: 0.3s;
        box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    }
    .widget-card:hover { transform: translateY(-5px); box-shadow: 0 0 25px rgba(255,0,0,0.4); }

    .widget-title { 
        font-size: 1rem; text-transform: uppercase; font-weight: 900; 
        color: var(--tet-gold); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; 
    }
    
    .countdown-flex { display: flex; gap: 15px; align-items: center; justify-content: center; }
    .count-block { text-align: center; }
    .count-val { font-size: 2rem; font-weight: 700; line-height: 1; font-family: var(--font-num); color: white; text-shadow: 2px 2px 0px #8B0000; }
    .count-lbl { font-size: 0.8rem; color: var(--tet-cream); margin-top: 4px; font-weight: bold; }
    
    .target-date { text-align: center; font-size: 0.85rem; color: rgba(255,255,255,0.7); margin-top: 10px; font-style: italic; }

    /* Quote Box */
    .quote-box {
        grid-column: 1 / -1;
        background: linear-gradient(90deg, rgba(255, 0, 0, 0.3), rgba(255, 215, 0, 0.1));
        border-left: 5px solid var(--tet-gold);
        padding: 15px; border-radius: 12px; font-style: italic; color: #FFD700; font-size: 1.1rem;
        display: flex; align-items: center; gap: 15px; font-family: var(--font-display);
    }

    /* === L·ªäCH H·ªåC === */
    .main-panel {
        background: rgba(50, 0, 0, 0.7);
        border: 1px solid var(--tet-gold);
        border-radius: 24px; padding: 20px;
        backdrop-filter: blur(15px);
        box-shadow: 0 0 30px rgba(0,0,0,0.5);
    }

    .tabs { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 15px; scrollbar-width: none; }
    .tabs::-webkit-scrollbar { display: none; }
    
    .tab {
        padding: 10px 20px; border-radius: 50px; background: rgba(0,0,0,0.4); border: 1px solid #555;
        color: rgba(255,255,255,0.8); font-weight: 600; font-size: 0.9rem; cursor: pointer; white-space: nowrap; transition: 0.3s;
    }
    .tab.active { 
        background: var(--tet-red); color: white; border-color: var(--tet-gold);
        box-shadow: 0 0 15px var(--tet-red); 
    }

    /* Table */
    .schedule-table { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
    .schedule-table th { text-align: left; color: var(--tet-gold); font-size: 0.9rem; text-transform: uppercase; padding: 0 10px; opacity: 1; text-shadow: 1px 1px 2px black; }
    
    .time-cell {
        background: rgba(0,0,0,0.3); border-radius: 15px 0 0 15px;
        padding: 15px; width: 80px; text-align: center; border: 1px solid var(--glass-border); border-right: none;
    }
    .t-main { font-weight: 700; font-size: 1.1rem; color: var(--tet-gold); font-family: var(--font-num); }
    .t-sub { font-size: 0.7rem; color: var(--tet-cream); margin-top: 3px; }

    .content-cell {
        background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
        padding: 8px; position: relative; transition: 0.3s; cursor: pointer; vertical-align: middle;
    }
    .content-cell:hover { background: rgba(255,255,255,0.15); border-color: var(--tet-gold); }
    .content-cell:last-child { border-radius: 0 15px 15px 0; }

    /* Th·∫ª M√¥n H·ªçc */
    .tag {
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        width: 100%; padding: 10px; border-radius: 12px; min-height: 50px; text-align: center;
        font-weight: 600; font-size: 0.95rem; transition: 0.2s;
    }
    /* M√†u s·∫Øc th·∫ª m·ªõi */
    .tag-anh { background: linear-gradient(135deg, #004d00, #006600); color: #ccffcc; border: 1px solid #00cc00; } /* Xanh l√° ƒë·∫≠m */
    .tag-em { background: linear-gradient(135deg, #660033, #99004d); color: #ffccdd; border: 1px solid #ff66b2; } /* H·ªìng ƒë·∫≠m */
    .tag-both { 
        background: linear-gradient(135deg, #b30000, #ff8c00); /* ƒê·ªè cam */
        color: white; border: 1px solid var(--tet-gold); box-shadow: 0 0 10px rgba(251, 191, 36, 0.4);
        font-weight: 800;
    }
    .tag-empty { opacity: 0.3; font-size: 1.5rem; line-height: 0; color: #666; }

    /* === CH·∫æ ƒê·ªò T·∫¨P TRUNG === */
    .focus-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #000; z-index: 9999; display: none;
        flex-direction: column; align-items: center; justify-content: center;
    }
    .focus-overlay.active { display: flex; animation: fadeIn 0.5s; }
    .focus-clock { font-size: 8rem; font-weight: 900; font-family: var(--font-num); color: var(--tet-gold); text-shadow: 0 0 30px var(--tet-red); }
    .focus-msg { font-size: 2rem; color: white; margin-top: 20px; font-family: var(--font-display); }
    .btn-exit-focus { margin-top: 50px; border: 2px solid #333; background: transparent; color: #666; padding: 10px 40px; border-radius: 50px; cursor: pointer; transition: 0.3s; font-weight: bold;}
    .btn-exit-focus:hover { color: var(--tet-gold); border-color: var(--tet-gold); background: rgba(255,215,0,0.1); }

    /* === MODAL & TOAST === */
    .toast {
        position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(50px);
        background: var(--tet-gold); color: #450a0a; padding: 12px 25px; border-radius: 30px; font-weight: bold;
        opacity: 0; transition: 0.4s; pointer-events: none; z-index: 2000; box-shadow: 0 0 30px var(--tet-gold);
    }
    .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

    .modal-wrap {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85);
        backdrop-filter: blur(8px); z-index: 1000; display: none; align-items: center; justify-content: center;
    }
    .modal-box {
        width: 90%; max-width: 400px; background: #2a0a0a; border: 2px solid var(--tet-gold);
        padding: 30px; border-radius: 20px; box-shadow: 0 0 50px rgba(220, 38, 38, 0.6);
        background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23450a0a' fill-opacity='0.4' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3Ccircle cx='13' cy='13' r='3'/%3E%3C/g%3E%3C/svg%3E");
    }
    .inp { width: 100%; background: #450a0a; border: 1px solid #7f1d1d; color: white; padding: 15px; border-radius: 10px; margin-bottom: 15px; font-size: 1rem; outline: none; }
    .inp:focus { border-color: var(--tet-gold); box-shadow: 0 0 10px var(--tet-gold); }
    .btn-save { width: 100%; background: var(--tet-gold); color: #450a0a; padding: 15px; border-radius: 10px; border: none; font-weight: 900; cursor: pointer; font-size: 1rem; text-transform: uppercase; letter-spacing: 1px;}

    #yt-player-container { position: absolute; top: -9999px; left: -9999px; opacity: 0; pointer-events: none; }
</style>
</head>
<body onclick="createFirework(event)">

<div class="lantern-box left">
    <div class="lantern-string"></div>
    <div class="lantern-body"><div class="lantern-text">T·∫øt</div></div>
    <div class="lantern-tassel"></div>
</div>
<div class="lantern-box right">
    <div class="lantern-string"></div>
    <div class="lantern-body"><div class="lantern-text">2026</div></div>
    <div class="lantern-tassel"></div>
</div>

<div class="flower-container" id="flowers"></div>
<div id="yt-player-container"></div>

<div class="focus-overlay" id="focusOverlay" onclick="event.stopPropagation()">
    <div class="focus-clock" id="focus-clock">00:00</div>
    <div class="focus-msg">"H·ªçc ng√†y 30 T·∫øt m·ªõi l√† ch·∫•t!"</div>
    <div style="margin-top:20px; color:#aaa; font-size: 0.9rem;">Ch·∫ø ƒë·ªô T·∫≠p Trung - T·∫øt 2026</div>
    <button class="btn-exit-focus" onclick="toggleFocus()">Tho√°t Ch·∫ø ƒê·ªô</button>
</div>

<div class="toast" id="toast">Th√¥ng b√°o h·ªá th·ªëng</div>

<div class="container animate__animated animate__fadeIn" onclick="event.stopPropagation()">
    <header>
        <div class="logo-area">
            <h1>T·∫øt H·ªçc T·∫≠p 2026</h1>
            <div class="greeting" id="greeting"><i class="fas fa-sun"></i> Ch√†o bu·ªïi s√°ng!</div>
        </div>
        <div class="user-actions">
            <div class="icon-btn" onclick="toggleFocus()" title="T·∫≠p trung"><i class="fas fa-eye"></i></div>
            <div class="icon-btn" onclick="toggleMusic()" title="Nh·∫°c Lofi Ng·∫´u Nhi√™n" id="music-btn"><i class="fas fa-music"></i></div>
            <div class="icon-btn" onclick="copyData()" title="Sao l∆∞u"><i class="fas fa-save"></i></div>
            <div class="icon-btn" onclick="pasteData()" title="Kh√¥i ph·ª•c"><i class="fas fa-file-import"></i></div>
        </div>
    </header>

    <div class="dashboard-grid">
        <div class="widget-card animate__animated animate__fadeInUp" style="animation-delay: 0.1s;">
            <div class="widget-title"><i class="fas fa-star"></i> T·∫øt B√≠nh Ng·ªç 2026</div>
            <div class="countdown-flex">
                <div class="count-block"><div class="count-val" id="t-d">00</div><div class="count-lbl">Ng√†y</div></div>
                <div class="count-block"><div class="count-val" id="t-h">00</div><div class="count-lbl">Gi·ªù</div></div>
                <div class="count-block"><div class="count-val" id="t-m">00</div><div class="count-lbl">Ph√∫t</div></div>
            </div>
            <div class="target-date">M·ª•c ti√™u: 17/02/2026</div>
        </div>

        <div class="widget-card animate__animated animate__fadeInUp" style="animation-delay: 0.2s;">
            <div class="widget-title"><i class="fas fa-graduation-cap"></i> Thi THPT Qu·ªëc Gia</div>
            <div class="countdown-flex">
                <div class="count-block"><div class="count-val" id="e-d">000</div><div class="count-lbl">Ng√†y</div></div>
                <div class="count-block"><div class="count-val" id="e-h">00</div><div class="count-lbl">Gi·ªù</div></div>
                <div class="count-block"><div class="count-val" id="e-m">00</div><div class="count-lbl">Ph√∫t</div></div>
            </div>
            <div class="target-date">Ng√†y thi: 11/06/2026</div>
        </div>

        <div class="quote-box animate__animated animate__fadeInUp" style="animation-delay: 0.3s;">
            <i class="fas fa-quote-left" style="color:var(--tet-gold)"></i>
            <span id="daily-quote">V·∫°n s·ª± kh·ªüi ƒë·∫ßu nan, gian nan ƒë·ª´ng c√≥ n·∫£n.</span>
        </div>
    </div>

    <div class="main-panel animate__animated animate__fadeInUp" style="animation-delay: 0.4s;">
        <div class="tabs" id="day-tabs"></div>
        
        <table class="schedule-table">
            <thead>
                <tr>
                    <th style="width:100px">Th·ªùi Gian</th>
                    <th>üå∏ Anh</th>
                    <th>‚ù§Ô∏è Em</th>
                </tr>
            </thead>
            <tbody id="schedule-body"></tbody>
        </table>
    </div>

    <div style="text-align:center; margin-top:30px; opacity:0.6; font-size:0.8rem;">
        <span style="cursor:pointer; color:var(--text-muted);" onclick="resetDefault()">[Kh√¥i Ph·ª•c M·∫∑c ƒê·ªãnh]</span>
    </div>
</div>

<div class="modal-wrap" id="editModal" onclick="event.stopPropagation()">
    <div class="modal-box animate__animated animate__zoomIn">
        <h3 style="color:var(--tet-gold); margin-top:0; text-align:center">C·∫≠p Nh·∫≠t L·ªãch Tr√¨nh</h3>
        <input type="hidden" id="e-day"><input type="hidden" id="e-session">
        
        <label style="display:block; color:#aaa; margin-bottom:5px; font-size:0.8rem">N·ªòI DUNG / M√îN H·ªåC</label>
        <input type="text" class="inp" id="e-subject" placeholder="VD: To√°n H√¨nh, VƒÉn...">
        
        <label style="display:block; color:#aaa; margin-bottom:5px; font-size:0.8rem">NG∆Ø·ªúI TH·ª∞C HI·ªÜN</label>
        <select class="inp" id="e-owner">
            <option value="empty">Tr·ªëng / Ngh·ªâ</option>
            <option value="you">Anh (H·ªçc ri√™ng)</option>
            <option value="ny">Em (H·ªçc ri√™ng)</option>
            <option value="both">H·ªçc Chung (ƒê√¥i)</option>
        </select>
        
        <button class="btn-save" onclick="saveData()">L∆ØU L·∫†I</button>
        <button style="width:100%; background:transparent; border:none; color:#aaa; padding:10px; cursor:pointer; margin-top:5px;" onclick="closeModal()">ƒê√≥ng H·ªôp Tho·∫°i</button>
    </div>
</div>

<script>
    /* ================= 1. C·∫§U H√åNH NH·∫†C LOFI ================= */
    const lofiVideos = ["jfKfPfyJRdk", "5qap5aO4i9A", "4xDzrJKXOOY", "F_N5iaM1vK8"];
    let isPlaying = false;
    let player = null;

    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    function onYouTubeIframeAPIReady() {}

    function toggleMusic() {
        const btn = document.getElementById('music-btn');
        if (!isPlaying) {
            const randomVid = lofiVideos[Math.floor(Math.random() * lofiVideos.length)];
            if(player) player.loadVideoById(randomVid);
            else {
                player = new YT.Player('yt-player-container', {
                    height: '1', width: '1', videoId: randomVid,
                    playerVars: { 'autoplay': 1, 'controls': 0, 'loop': 1 },
                    events: { 'onReady': (event) => event.target.playVideo() }
                });
            }
            isPlaying = true; btn.classList.add('active'); btn.innerHTML = '<i class="fas fa-volume-up"></i>'; showToast("ƒêang ph√°t nh·∫°c T·∫øt Lofi...");
        } else {
            if(player) player.stopVideo();
            isPlaying = false; btn.classList.remove('active'); btn.innerHTML = '<i class="fas fa-music"></i>'; showToast("ƒê√£ t·∫Øt nh·∫°c.");
        }
    }

    /* ================= 2. D·ªÆ LI·ªÜU L·ªäCH (ƒê√É S·ª¨A THEO Y√äU C·∫¶U) ================= */
    const configEm = {
        "Th·ª© 2": ["Sinh", "H√≥a", "To√°n"],
        "Th·ª© 3": ["H√≥a", "To√°n", "Sinh"],
        "Th·ª© 4": ["To√°n", "Sinh", "H√≥a"],
        "Th·ª© 5": ["Sinh", "To√°n", "H√≥a"],
        "Th·ª© 6": ["To√°n", "H√≥a", "Sinh"],
        "Th·ª© 7": ["H√≥a", "Sinh", "To√°n"],
        "CN":    ["Ngh·ªâ", "Ngh·ªâ", "Ngh·ªâ"]
    };
    
    // ƒê√É S·ª¨A: Th·ª© 2-4-6 VƒÉn | Th·ª© 3-5-7 GDKT-PL
    const configAnh = {
        "Th·ª© 2": ["To√°n", "Ng·ªØ VƒÉn", "S·ª≠"],
        "Th·ª© 3": ["To√°n", "GDKT - PL", "S·ª≠"],
        "Th·ª© 4": ["To√°n", "Ng·ªØ VƒÉn", "S·ª≠"],
        "Th·ª© 5": ["To√°n", "GDKT - PL", "S·ª≠"],
        "Th·ª© 6": ["To√°n", "Ng·ªØ VƒÉn", "S·ª≠"],
        "Th·ª© 7": ["To√°n", "GDKT - PL", "S·ª≠"],
        "CN":    ["GDKT-PL", "GDKT-PL", "2 ƒê·ªÅ ƒêGNL & V-SAT"] 
    };

    const monTruaAnh = "ƒê·ªÄ ƒêGNL";
    const days = ["Th·ª© 2", "Th·ª© 3", "Th·ª© 4", "Th·ª© 5", "Th·ª© 6", "Th·ª© 7", "CN"];
    const sessions = [
        {key: "sang", label: "S√ÅNG", time: "08:00"},
        {key: "trua", label: "TR∆ØA", time: "12:00"},
        {key: "chieu", label: "CHI·ªÄU", time: "14:00"},
        {key: "toi", label: "T·ªêI", time: "19:00"}
    ];

    const quotes = [
        "NƒÉm m·ªõi th·∫Øng l·ª£i m·ªõi!",
        "VƒÉn hay ch·ªØ t·ªët, ƒë·ªó ƒë·∫°t vinh quang.",
        "GDKT & PL: Hi·ªÉu lu·∫≠t ƒë·ªÉ th√†nh c√¥ng.",
        "M·ª•c ti√™u 27 ƒëi·ªÉm ƒëang ch·ªù ph√≠a tr∆∞·ªõc!",
        "T·∫øt n√†y v·∫´n h·ªçc, t∆∞∆°ng lai s√°ng ng·ªùi."
    ];

    /* ================= 3. LOGIC X·ª¨ L√ù ================= */
    const examDate = new Date('2026-06-11T00:00:00').getTime();
    const tetDate = new Date('2026-02-17T00:00:00').getTime();

    function updateCountdowns() {
        const now = new Date().getTime();
        renderTimer(tetDate - now, 't');
        renderTimer(examDate - now, 'e');
    }

    function renderTimer(distance, prefix) {
        if(distance < 0) distance = 0;
        const d = Math.floor(distance / (1000 * 60 * 60 * 24));
        const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        document.getElementById(`${prefix}-d`).innerText = d < 10 ? '0'+d : d;
        document.getElementById(`${prefix}-h`).innerText = h < 10 ? '0'+h : h;
        document.getElementById(`${prefix}-m`).innerText = m < 10 ? '0'+m : m;
    }

    function generateDefaultData() {
        let data = {};
        days.forEach(day => {
            data[day] = {};
            let subEm = configEm[day] || ["","",""];
            let subAnh = configAnh[day] || [];
            let aIdx = 0;
            ["sang", "chieu", "toi"].forEach((key, idx) => {
                let sEm = subEm[idx];
                let sAnh = "";
                let owner = "empty";
                if (aIdx < subAnh.length) { sAnh = subAnh[aIdx]; aIdx++; }
                if (sAnh && sEm && sAnh !== "Ngh·ªâ" && sEm !== "Ngh·ªâ") {
                    if (sAnh === sEm) { owner = "both"; if (sAnh === "To√°n") sAnh = "To√°n (Chung)"; } 
                    else owner = "split";
                } else if (sAnh && sAnh !== "Ngh·ªâ") owner = "you";
                else if (sEm && sEm !== "Ngh·ªâ") owner = "ny";

                if(owner === "split") data[day][key] = {s: sAnh + "|" + sEm, o: "split"};
                else if(owner === "both") data[day][key] = {s: sAnh, o: "both"};
                else if(owner === "you") data[day][key] = {s: sAnh, o: "you"};
                else if(owner === "ny") data[day][key] = {s: sEm, o: "ny"};
                else data[day][key] = {s: "Tr·ªëng", o: "empty"};
            });
            if(day === "CN") data[day]["trua"] = {s: "Tr·ªëng", o: "empty"};
            else data[day]["trua"] = {s: monTruaAnh, o: "you"};
        });
        return data;
    }

    // Key l∆∞u tr·ªØ m·ªõi ƒë·ªÉ tr√°nh xung ƒë·ªôt v·ªõi b·∫£n c≈©
    let schedule = JSON.parse(localStorage.getItem('Tet2026_Data_V2')) || generateDefaultData();
    let currentIdx = new Date().getDay() === 0 ? 6 : new Date().getDay() - 1;
    if(currentIdx < 0) currentIdx = 0;

    function init() {
        createFlowers();
        renderTabs();
        renderTable();
        updateGreeting();
        setInterval(updateCountdowns, 1000);
        setInterval(updateClockFocus, 1000);
        updateCountdowns();
        document.getElementById('daily-quote').innerText = quotes[Math.floor(Math.random()*quotes.length)];
    }

    function renderTabs() {
        const c = document.getElementById('day-tabs'); c.innerHTML = '';
        days.forEach((d, i) => {
            let b = document.createElement('div'); b.className = `tab ${i === currentIdx ? 'active' : ''}`;
            b.innerText = d; b.onclick = () => { currentIdx = i; renderTabs(); renderTable(); }; c.appendChild(b);
        });
    }

    function renderTable() {
        const body = document.getElementById('schedule-body'); body.innerHTML = '';
        const dayData = schedule[days[currentIdx]] || {};
        sessions.forEach(sess => {
            const item = dayData[sess.key] || {s: "...", o: "empty"};
            let htmlA = '', htmlB = '';
            if(item.o === 'split') {
                let p = item.s.split('|'); htmlA = `<div class="tag tag-anh">${p[0]}</div>`; htmlB = `<div class="tag tag-em">${p[1]}</div>`;
            } else if (item.o === 'both') {
                htmlA = `<div class="tag tag-both">H·ªçc Chung: ${item.s}</div>`; htmlB = `<div class="tag tag-both">H·ªçc Chung: ${item.s}</div>`;
            } else if (item.o === 'you') {
                htmlA = `<div class="tag tag-anh">${item.s}</div>`; htmlB = `<div class="tag tag-empty">&middot;</div>`;
            } else if (item.o === 'ny') {
                htmlA = `<div class="tag tag-empty">&middot;</div>`; htmlB = `<div class="tag tag-em">${item.s}</div>`;
            } else {
                htmlA = `<div class="tag tag-empty">&middot;</div>`; htmlB = `<div class="tag tag-empty">&middot;</div>`;
            }
            let tr = document.createElement('tr');
            tr.innerHTML = `<td class="time-cell"><div class="t-main">${sess.time}</div><div class="t-sub">${sess.label}</div></td>
                <td class="content-cell" onclick="openModal('${sess.key}', 'you')">${htmlA}</td>
                <td class="content-cell" onclick="openModal('${sess.key}', 'ny')">${htmlB}</td>`;
            body.appendChild(tr);
        });
    }

    const modal = document.getElementById('editModal');
    function openModal(key, pref) {
        const d = days[currentIdx]; const item = schedule[d][key] || {s:"", o:"empty"};
        document.getElementById('e-day').value = d; document.getElementById('e-session').value = key;
        let s = item.s; if(item.o === 'split') s = s.replace('|', ' & ');
        document.getElementById('e-subject').value = s;
        let o = item.o === 'empty' ? pref : (item.o === 'split' ? 'both' : item.o);
        document.getElementById('e-owner').value = o; modal.style.display = 'flex';
    }
    function closeModal() { modal.style.display = 'none'; }
    function saveData() {
        const d = document.getElementById('e-day').value; const k = document.getElementById('e-session').value;
        const s = document.getElementById('e-subject').value; const o = document.getElementById('e-owner').value;
        if(!schedule[d]) schedule[d] = {}; schedule[d][k] = {s: s, o: o};
        localStorage.setItem('Tet2026_Data_V2', JSON.stringify(schedule)); renderTable(); closeModal(); showToast("ƒê√£ l∆∞u l·ªãch!");
    }

    function toggleFocus() {
        const el = document.getElementById('focusOverlay'); el.classList.toggle('active');
        if(el.classList.contains('active')) { if(document.documentElement.requestFullscreen) document.documentElement.requestFullscreen(); }
        else { if(document.exitFullscreen) document.exitFullscreen(); }
    }
    function updateClockFocus() { document.getElementById('focus-clock').innerText = new Date().toLocaleTimeString('vi-VN', {hour: '2-digit', minute:'2-digit'}); }
    function updateGreeting() {
        const h = new Date().getHours(); let g = "Ch√†o bu·ªïi s√°ng!"; let i = "sun";
        if(h >= 12 && h < 18) { g = "Ch√†o bu·ªïi chi·ªÅu!"; i = "cloud-sun"; } else if(h >= 18) { g = "Ch√†o bu·ªïi t·ªëi!"; i = "moon"; }
        document.getElementById('greeting').innerHTML = `<i class="fas fa-${i}"></i> ${g}`;
    }

    function createFlowers() {
        const c = document.getElementById('flowers');
        for(let i=0; i<30; i++) {
            let f = document.createElement('div'); f.className = Math.random() > 0.5 ? 'flower' : 'flower yellow';
            f.style.left = Math.random() * 100 + '%'; f.style.top = -20 + 'px';
            c.appendChild(f); animateFlower(f);
        }
    }
    function animateFlower(f) {
        const duration = Math.random() * 5000 + 5000; const startX = Math.random() * window.innerWidth;
        f.animate([
            { transform: `translate(${startX}px, -20px) rotate(0deg)`, opacity: 0 },
            { opacity: 1, offset: 0.1 },
            { transform: `translate(${startX + Math.random()*100 - 50}px, ${window.innerHeight}px) rotate(360deg)`, opacity: 0 }
        ], { duration: duration, iterations: Infinity, delay: Math.random() * 5000 });
    }

    function createFirework(e) {
        // T·∫°o hi·ªáu ·ª©ng ph√°o hoa khi click
        const colors = ['#FFD700', '#FF0000', '#FFFFFF', '#FFA500'];
        const x = e.clientX;
        const y = e.clientY;
        for (let i = 0; i < 20; i++) {
            const p = document.createElement('div');
            p.className = 'firework-particle';
            p.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            p.style.left = x + 'px';
            p.style.top = y + 'px';
            // Random direction
            const angle = Math.random() * Math.PI * 2;
            const velocity = Math.random() * 100 + 50;
            p.style.setProperty('--tx', Math.cos(angle) * velocity + 'px');
            p.style.setProperty('--ty', Math.sin(angle) * velocity + 'px');
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 1000);
        }
    }

    function showToast(msg) { const t = document.getElementById('toast'); t.innerText = msg; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 3000); }
    function copyData() { navigator.clipboard.writeText(JSON.stringify(schedule)); showToast("ƒê√£ sao ch√©p!"); }
    function pasteData() {
        let v = prompt("D√°n m√£ d·ªØ li·ªáu:");
        if(v) { try { schedule = JSON.parse(v); localStorage.setItem('Tet2026_Data_V2', v); renderTable(); showToast("ƒê√£ kh√¥i ph·ª•c!"); } catch(e) { alert("L·ªói d·ªØ li·ªáu!"); } }
    }
    function resetDefault() { if(confirm("ƒê·∫∑t l·∫°i v·ªÅ m·∫∑c ƒë·ªãnh (VƒÉn 2-4-6, GDKT 3-5-7)?")) { localStorage.removeItem('Tet2026_Data_V2'); location.reload(); } }

    init();
</script>
</body>
</html>
