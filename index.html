<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>L·ªãch H·ªçc ƒê√¥i B·∫°n</title>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
    :root {
        --tet-red: #991b1b;
        --tet-gold: #fbbf24;
        --glass: rgba(255, 255, 255, 0.95);
        
        /* 3 M√†u Ch√≠nh */
        --color-you: #2563eb;  /* Blue - B·∫°n */
        --color-ny: #d946ef;   /* Purple - Ny */
        --color-both: #16a34a; /* Green - H·ªçc chung */
    }

    body {
        margin: 0;
        font-family: "Montserrat", sans-serif;
        background: radial-gradient(circle at center, #7f1d1d, #2a0404);
        color: #1f2937;
        min-height: 100vh;
        overflow-x: hidden;
    }

    /* Hoa r∆°i */
    .falling-flowers {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: 0;
    }
    .flower {
        position: absolute; width: 10px; height: 10px;
        background: #fecaca; border-radius: 50%; opacity: 0.7;
        animation: fall linear infinite;
    }
    .flower:nth-child(2n) { background: #fde047; }
    @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }

    .container {
        position: relative; z-index: 10;
        max-width: 1200px; margin: 0 auto; padding: 15px;
    }

    /* Header */
    header {
        text-align: center;
        background: rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(5px);
        border: 2px solid var(--tet-gold);
        border-radius: 20px;
        padding: 20px;
        margin-bottom: 25px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    h1 {
        font-family: 'Dancing Script', cursive;
        color: var(--tet-gold);
        font-size: 2.8rem; margin: 0;
        text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
    }

    .status-bar {
        display: flex; justify-content: center; flex-wrap: wrap; gap: 15px;
        margin-top: 15px; color: white;
    }
    .live-clock { font-weight: bold; font-size: 1.1rem; align-self: center;}
    .reminder-badge {
        background: var(--tet-red); color: white;
        padding: 6px 16px; border-radius: 50px;
        font-size: 0.95rem; border: 1px solid var(--tet-gold);
        animation: pulse 2s infinite; font-weight: 600;
    }
    @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.05);} 100% {transform: scale(1);} }

    /* Legend: 3 m·ª•c */
    .legend {
        display: flex; justify-content: center; gap: 15px; margin-bottom: 25px; flex-wrap: wrap;
    }
    .tag {
        padding: 8px 18px; border-radius: 50px; color: white;
        font-size: 0.95rem; font-weight: 700;
        display: flex; align-items: center; gap: 8px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        transition: transform 0.2s;
    }
    .tag:hover { transform: translateY(-2px); }
    .tag.you { background: var(--color-you); }
    .tag.ny { background: var(--color-ny); }
    .tag.both { background: var(--color-both); }

    /* Grid L·ªãch */
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 20px;
    }

    .day-card {
        background: var(--glass);
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        transition: 0.3s;
    }
    .day-card.today {
        border: 3px solid var(--tet-gold);
        transform: scale(1.02); z-index: 5;
    }

    .day-header {
        background: var(--tet-red); color: var(--tet-gold);
        padding: 12px; text-align: center;
        font-weight: 800; text-transform: uppercase; letter-spacing: 1px;
    }

    .session {
        padding: 14px 16px;
        border-bottom: 1px solid #e5e7eb;
        display: flex; justify-content: space-between; align-items: center;
        cursor: pointer; transition: background 0.2s;
    }
    .session:hover { background: #fee2e2; }
    .session:last-child { border-bottom: none; }

    .ss-time { font-size: 0.85rem; font-weight: 600; color: #6b7280; width: 50px; }
    .ss-info { flex: 1; font-weight: 700; font-size: 1rem; }
    
    /* M√†u ch·ªØ */
    .txt-you { color: var(--color-you); }
    .txt-ny { color: var(--color-ny); }
    .txt-both { color: var(--color-both); }
    .txt-empty { color: #9ca3af; font-weight: normal; font-style: italic; }

    /* Controls */
    .controls {
        text-align: center; margin-top: 40px;
        padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.2);
        display: flex; justify-content: center; gap: 15px;
    }
    .btn-icon {
        background: rgba(0,0,0,0.5); color: var(--tet-gold);
        border: 1px solid var(--tet-gold);
        padding: 10px 20px; border-radius: 30px;
        cursor: pointer; font-size: 0.9rem; font-weight: 600;
        transition: 0.2s; display: flex; align-items: center; gap: 8px;
    }
    .btn-icon:hover { background: var(--tet-gold); color: var(--tet-red); }

    /* Modal Edit */
    .modal-wrap {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); z-index: 100;
        display: none; align-items: center; justify-content: center;
        backdrop-filter: blur(5px);
    }
    .modal {
        background: white; width: 90%; max-width: 400px;
        padding: 25px; border-radius: 15px;
        border: 2px solid var(--tet-gold);
        animation: zoomIn 0.3s;
    }
    @keyframes zoomIn { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }

    label { display: block; margin: 15px 0 5px; font-weight: bold; color: var(--tet-red); }
    input, select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 1rem;}
    
    .modal-btns { margin-top: 25px; display: flex; gap: 10px; }
    .btn-save { flex: 1; background: var(--tet-red); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }
    .btn-close { flex: 1; background: #e5e7eb; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }

</style>
</head>
<body>

<div class="falling-flowers" id="flower-container"></div>

<div class="container">
    <header>
        <h1>üå∏ L·ªãch H·ªçc ƒê√¥i B·∫°n üå∏</h1>
        <div class="status-bar">
            <div class="live-clock" id="clock">Loading...</div>
            <div class="reminder-badge" id="reminder">üîî ƒêang ki·ªÉm tra l·ªãch...</div>
        </div>
    </header>

    <div class="legend">
        <div class="tag you"><i class="fas fa-user"></i> B·∫°n</div>
        <div class="tag ny"><i class="fas fa-heart"></i> Ny</div>
        <div class="tag both"><i class="fas fa-users"></i> H·ªçc chung</div>
    </div>

    <div class="grid" id="schedule-grid"></div>

    <div class="controls">
        <button class="btn-icon" onclick="copyData()"><i class="fas fa-copy"></i> Copy C·∫•u H√¨nh</button>
        <button class="btn-icon" onclick="pasteData()"><i class="fas fa-file-import"></i> N·∫°p D·ªØ Li·ªáu</button>
        <button class="btn-icon" onclick="resetDefault()" style="border-color:#fca5a5; color:#fca5a5"><i class="fas fa-redo"></i> Reset</button>
    </div>
</div>

<div class="modal-wrap" id="editModal">
    <div class="modal">
        <h2 style="text-align: center; color: var(--tet-red); margin-top: 0;">üßß S·ª≠a L·ªãch H·ªçc</h2>
        <input type="hidden" id="e-day">
        <input type="hidden" id="e-session">

        <label>M√¥n h·ªçc / N·ªôi dung:</label>
        <input type="text" id="e-subject" placeholder="VD: To√°n H√¨nh">

        <label>Ai h·ªçc?</label>
        <select id="e-owner">
            <option value="empty">‚ö™ Ngh·ªâ / Tr·ªëng</option>
            <option value="you">üîµ B·∫°n (Ri√™ng)</option>
            <option value="ny">üü£ Ny (Ri√™ng)</option>
            <option value="both">üü¢ H·ªçc Chung</option>
        </select>

        <div class="modal-btns">
            <button class="btn-close" onclick="closeModal()">H·ªßy</button>
            <button class="btn-save" onclick="saveData()">L∆∞u L·ªãch</button>
        </div>
    </div>
</div>

<script>
    // D·ªØ li·ªáu chu·∫©n: ƒê√£ chuy·ªÉn L√Ω v·ªÅ th√†nh "you" (B·∫°n)
    const defaultData = {
        "Th·ª© 2": { 
            sang: {s:"To√°n (Chung)", o:"both"}, 
            chieu: {s:"V·∫≠t L√Ω", o:"you"}, // ƒê√£ s·ª≠a th√†nh you
            toi: {s:"Sinh", o:"ny"} 
        },
        "Th·ª© 3": { 
            sang: {s:"H√≥a (Chung)", o:"both"}, 
            chieu: {s:"S·ª≠", o:"you"}, 
            toi: {s:"Sinh", o:"ny"} 
        },
        "Th·ª© 4": { 
            sang: {s:"GDKT", o:"you"}, 
            chieu: {s:"To√°n (Chung)", o:"both"}, 
            toi: {s:"V·∫≠t L√Ω (B√†i t·∫≠p)", o:"you"} // ƒê√£ s·ª≠a th√†nh you
        },
        "Th·ª© 5": { 
            sang: {s:"Sinh", o:"ny"}, 
            chieu: {s:"H√≥a (Chung)", o:"both"}, 
            toi: {s:"V·∫≠t L√Ω", o:"you"} // ƒê√£ s·ª≠a th√†nh you
        },
        "Th·ª© 6": { 
            sang: {s:"To√°n (Chung)", o:"both"}, 
            chieu: {s:"S·ª≠", o:"you"}, 
            toi: {s:"Ngh·ªâ", o:"empty"} 
        },
        "Th·ª© 7": { 
            sang: {s:"V·∫≠t L√Ω (Chuy√™n ƒë·ªÅ)", o:"you"}, // ƒê√£ s·ª≠a th√†nh you
            chieu: {s:"Sinh", o:"ny"}, 
            toi: {s:"√în To√°n ‚Äì H√≥a", o:"both"} 
        },
        "CN": { 
            sang: {s:"Ngh·ªâ", o:"empty"}, 
            chieu: {s:"Reset tinh th·∫ßn üåø", o:"empty"}, 
            toi: {s:"Ngh·ªâ ng∆°i", o:"empty"} 
        }
    };

    const days = ["Th·ª© 2", "Th·ª© 3", "Th·ª© 4", "Th·ª© 5", "Th·ª© 6", "Th·ª© 7", "CN"];
    const sessions = [
        {key: "sang", label: "S√°ng", time: "08:00"},
        {key: "chieu", label: "Chi·ªÅu", time: "14:00"},
        {key: "toi", label: "T·ªëi", time: "19:30"}
    ];

    let schedule = JSON.parse(localStorage.getItem('coupleTetScheduleV2')) || defaultData;

    function render() {
        const grid = document.getElementById('schedule-grid');
        grid.innerHTML = '';
        
        const now = new Date();
        const currentDayIndex = now.getDay() === 0 ? 6 : now.getDay() - 1;

        days.forEach((day, index) => {
            const isToday = index === currentDayIndex;
            const data = schedule[day];
            
            const card = document.createElement('div');
            card.className = `day-card ${isToday ? 'today' : ''}`;
            
            let html = `<div class="day-header">${day} ${isToday ? 'üö©' : ''}</div>`;
            
            sessions.forEach(sess => {
                const item = data[sess.key] || {s:"Tr·ªëng", o:"empty"};
                // Icon
                let icon = '';
                if(item.o === 'you') icon = '<i class="fas fa-user"></i>';
                else if(item.o === 'ny') icon = '<i class="fas fa-heart"></i>';
                else if(item.o === 'both') icon = '<i class="fas fa-users"></i>';

                html += `
                    <div class="session" onclick="openModal('${day}', '${sess.key}')">
                        <div class="ss-time">${sess.label}</div>
                        <div class="ss-info txt-${item.o}">
                            ${item.s}
                        </div>
                        <div style="font-size:0.8rem; color:#aaa">${icon}</div>
                    </div>
                `;
            });
            
            card.innerHTML = html;
            grid.appendChild(card);
        });
        
        checkReminder();
    }

    // Modal
    function openModal(day, sessKey) {
        const item = schedule[day][sessKey];
        document.getElementById('e-day').value = day;
        document.getElementById('e-session').value = sessKey;
        document.getElementById('e-subject').value = item.s === "Tr·ªëng" ? "" : item.s;
        
        // N·∫øu d·ªØ li·ªáu c≈© l√† 'phy', chuy·ªÉn hi·ªÉn th·ªã th√†nh 'you'
        let ownerVal = item.o;
        if(ownerVal === 'phy') ownerVal = 'you';
        
        document.getElementById('e-owner').value = ownerVal;
        document.getElementById('editModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('editModal').style.display = 'none';
    }

    function saveData() {
        const day = document.getElementById('e-day').value;
        const key = document.getElementById('e-session').value;
        const sub = document.getElementById('e-subject').value || "Tr·ªëng";
        const owner = document.getElementById('e-owner').value;

        schedule[day][key] = {s: sub, o: owner};
        localStorage.setItem('coupleTetScheduleV2', JSON.stringify(schedule));
        
        render();
        closeModal();
    }

    // ƒê·ªìng h·ªì & Nh·∫Øc nh·ªü
    function updateTime() {
        const now = new Date();
        document.getElementById('clock').innerText = now.toLocaleTimeString('vi-VN') + 
            " - " + now.toLocaleDateString('vi-VN', {weekday:'long', day:'numeric', month:'numeric'});
        
        if(now.getSeconds() === 0) checkReminder();
    }

    function checkReminder() {
        const now = new Date();
        const dayIdx = now.getDay() === 0 ? 6 : now.getDay() - 1;
        const currentDay = days[dayIdx];
        const h = now.getHours();

        let msg = "ƒê√£ xong l·ªãch h√¥m nay! üí§";
        const todayData = schedule[currentDay];

        if(h < 11) {
            if(todayData.sang.o !== 'empty') msg = `S·∫Øp t·ªõi: ${todayData.sang.s} (S√°ng)`;
        } else if(h < 17) {
            if(todayData.chieu.o !== 'empty') msg = `S·∫Øp t·ªõi: ${todayData.chieu.s} (Chi·ªÅu)`;
            else if(todayData.toi.o !== 'empty') msg = `T·ªëi nay: ${todayData.toi.s}`;
        } else if(h < 22) {
            if(todayData.toi.o !== 'empty') msg = `ƒêang di·ªÖn ra: ${todayData.toi.s}`;
        }

        document.getElementById('reminder').innerText = "üîî " + msg;
    }

    // Sync
    function copyData() {
        navigator.clipboard.writeText(JSON.stringify(schedule)).then(() => {
            alert("ƒê√£ copy m√£ c·∫•u h√¨nh!");
        });
    }

    function pasteData() {
        const code = prompt("D√°n m√£ c·∫•u h√¨nh v√†o ƒë√¢y:");
        if(code) {
            try {
                schedule = JSON.parse(code);
                localStorage.setItem('coupleTetScheduleV2', JSON.stringify(schedule));
                render();
                alert("ƒê√£ c·∫≠p nh·∫≠t!");
            } catch(e) { alert("L·ªói m√£!"); }
        }
    }
    
    function resetDefault() {
        if(confirm("V·ªÅ l·∫°i m·∫∑c ƒë·ªãnh ban ƒë·∫ßu?")) {
            localStorage.removeItem('coupleTetScheduleV2');
            location.reload();
        }
    }

    // Hoa r∆°i
    function initFlowers() {
        const c = document.getElementById('flower-container');
        for(let i=0; i<25; i++) {
            let f = document.createElement('div');
            f.className = 'flower';
            f.style.left = Math.random()*100 + '%';
            f.style.animationDuration = (Math.random()*5 + 5) + 's';
            f.style.animationDelay = Math.random()*5 + 's';
            c.appendChild(f);
        }
    }

    initFlowers();
    render();
    setInterval(updateTime, 1000);

</script>
</body>
</html>
