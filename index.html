<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>L·ªãch H·ªçc ƒê√¥i B·∫°n - Table View</title>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
<style>
    :root {
        --tet-red: #991b1b;
        --tet-gold: #fbbf24;
        --glass: rgba(255, 255, 255, 0.95);
        
        /* 3 M√†u Ch√≠nh */
        --color-you: #2563eb;  /* Blue - Anh */
        --color-ny: #d946ef;   /* Purple - Em */
        --color-both: #16a34a; /* Green - Chung */
    }

    body {
        margin: 0;
        font-family: "Montserrat", sans-serif;
        background: radial-gradient(circle at center, #7f1d1d, #2a0404);
        color: #1f2937;
        min-height: 100vh;
        overflow-x: hidden;
        padding-bottom: 50px;
    }

    /* Hoa r∆°i */
    .falling-flowers {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: 0;
    }
    .flower {
        position: absolute; width: 10px; height: 10px;
        background: #fecaca; border-radius: 50%; opacity: 0.7;
        animation: fall linear infinite;
    }
    .flower:nth-child(2n) { background: #fde047; }
    @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }

    .container {
        position: relative; z-index: 10;
        max-width: 800px; 
        margin: 0 auto; padding: 10px;
    }

    /* Header */
    header {
        text-align: center;
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(5px);
        border: 2px solid var(--tet-gold);
        border-radius: 15px;
        padding: 15px;
        margin-bottom: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    h1 {
        font-family: 'Dancing Script', cursive;
        color: var(--tet-gold);
        font-size: 2.2rem; margin: 0;
        text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
    }

    .live-clock { color: white; margin-top: 10px; font-weight: bold;}
    .reminder-badge {
        display: inline-block;
        background: var(--tet-red); color: white;
        padding: 5px 15px; border-radius: 50px;
        font-size: 0.9rem; border: 1px solid var(--tet-gold);
        margin-top: 10px;
        animation: pulse 2s infinite; font-weight: 600;
    }
    @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.05);} 100% {transform: scale(1);} }

    /* Day Selector Tabs */
    .day-tabs {
        display: flex;
        overflow-x: auto;
        gap: 10px;
        padding-bottom: 10px;
        margin-bottom: 15px;
        scrollbar-width: none; /* Hide scrollbar Firefox */
    }
    .day-tabs::-webkit-scrollbar { display: none; } /* Hide scrollbar Chrome */
    
    .tab-item {
        background: rgba(255,255,255,0.2);
        color: white;
        padding: 10px 15px;
        border-radius: 10px;
        white-space: nowrap;
        cursor: pointer;
        border: 1px solid transparent;
        transition: 0.3s;
        font-weight: bold;
    }
    .tab-item.active {
        background: var(--tet-gold);
        color: var(--tet-red);
        border-color: white;
        box-shadow: 0 0 10px var(--tet-gold);
    }

    /* TABLE STYLES */
    .table-container {
        background: var(--glass);
        border-radius: 15px;
        overflow: hidden;
        border: 2px solid var(--tet-gold);
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    th {
        background: var(--tet-red);
        color: var(--tet-gold);
        padding: 15px 5px;
        font-size: 1.1rem;
    }
    
    /* C·ªôt th·ªùi gian */
    td.time-col {
        background: #fef2f2;
        width: 15%;
        text-align: center;
        font-weight: 800;
        color: var(--tet-red);
        border-bottom: 1px solid #ddd;
        border-right: 2px solid #ddd;
        font-size: 0.9rem;
    }

    /* C·ªôt n·ªôi dung */
    td.content-col {
        width: 42.5%; /* Chia ƒë·ªÅu */
        padding: 10px;
        vertical-align: middle;
        border-bottom: 1px solid #eee;
        border-right: 1px solid #eee;
        cursor: pointer;
        transition: background 0.2s;
        position: relative;
    }
    td.content-col:last-child { border-right: none; }
    td.content-col:hover { background: #fffbeb; }

    /* Styles cho text trong √¥ */
    .cell-content {
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        text-align: center; min-height: 50px;
    }
    .subject-name { font-weight: 700; font-size: 1rem; margin-bottom: 5px; }
    .status-icon { font-size: 1.2rem; opacity: 0.8; margin-top: 2px;}

    /* M√†u s·∫Øc theo ng∆∞·ªùi */
    .txt-anh { color: var(--color-you); }
    .txt-em { color: var(--color-ny); }
    .txt-chung { color: var(--color-both); }
    .txt-empty { color: #ccc; font-style: italic; font-size: 0.9rem;}

    /* Controls */
    .controls {
        text-align: center; margin-top: 30px;
        display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;
    }
    .btn-icon {
        background: rgba(0,0,0,0.6); color: var(--tet-gold);
        border: 1px solid var(--tet-gold);
        padding: 10px 15px; border-radius: 30px;
        cursor: pointer; font-size: 0.85rem; font-weight: 600;
        transition: 0.2s; display: flex; align-items: center; gap: 6px;
    }
    .btn-icon:hover { background: var(--tet-gold); color: var(--tet-red); }

    /* Modal */
    .modal-wrap {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); z-index: 100;
        display: none; align-items: center; justify-content: center;
        backdrop-filter: blur(5px);
    }
    .modal {
        background: white; width: 90%; max-width: 400px;
        padding: 25px; border-radius: 15px;
        border: 2px solid var(--tet-gold);
        animation: zoomIn 0.3s;
    }
    @keyframes zoomIn { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }
    
    label { display: block; margin: 15px 0 5px; font-weight: bold; color: var(--tet-red); }
    input, select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 1rem;}
    .modal-btns { margin-top: 25px; display: flex; gap: 10px; }
    .btn-save { flex: 1; background: var(--tet-red); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }
    .btn-close { flex: 1; background: #e5e7eb; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }

    /* Mobile Responsive adjustments */
    @media (max-width: 400px) {
        h1 { font-size: 1.8rem; }
        th { font-size: 1rem; }
        .subject-name { font-size: 0.9rem; }
    }
</style>
</head>
<body>

<div class="falling-flowers" id="flower-container"></div>

<div class="container">
    <header>
        <h1>üå∏ L·ªãch H·ªçc ƒê√¥i B·∫°n üå∏</h1>
        <div class="live-clock" id="clock">Loading...</div>
        <div class="reminder-badge" id="reminder">üîî ƒêang t·∫£i...</div>
    </header>

    <div class="day-tabs" id="day-tabs">
        </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th style="width:15%">Ca</th>
                    <th style="width:42.5%">üå∏ Anh</th>
                    <th style="width:42.5%">‚ù§Ô∏è Em</th>
                </tr>
            </thead>
            <tbody id="schedule-body">
                </tbody>
        </table>
    </div>

    <div class="controls">
        <button class="btn-icon" onclick="copyData()">üå∏ Copy M√£</button>
        <button class="btn-icon" onclick="pasteData()">üå∏ N·∫°p M√£</button>
        <button class="btn-icon" onclick="resetDefault()" style="border-color:#fca5a5; color:#fca5a5">üå∏ Reset</button>
    </div>
</div>

<div class="modal-wrap" id="editModal">
    <div class="modal">
        <h2 style="text-align: center; color: var(--tet-red); margin-top: 0;">üßß S·ª≠a L·ªãch H·ªçc</h2>
        
        <input type="hidden" id="e-day">
        <input type="hidden" id="e-session">

        <label>M√¥n h·ªçc / N·ªôi dung:</label>
        <input type="text" id="e-subject" placeholder="VD: To√°n H√¨nh, ƒÇn tr∆∞a...">

        <label>Ai th·ª±c hi·ªán?</label>
        <select id="e-owner">
            <option value="empty">‚ö™ Tr·ªëng / Ngh·ªâ</option>
            <option value="you">üå∏ Anh (Ri√™ng)</option>
            <option value="ny">‚ù§Ô∏è Em (Ri√™ng)</option>
            <option value="both">üå∏‚ù§Ô∏è C√πng Nhau</option>
        </select>

        <div class="modal-btns">
            <button class="btn-close" onclick="closeModal()">H·ªßy</button>
            <button class="btn-save" onclick="saveData()">L∆∞u Thay ƒê·ªïi</button>
        </div>
    </div>
</div>

<script>
    // 1. C·∫•u h√¨nh D·ªØ li·ªáu m·∫∑c ƒë·ªãnh (ƒê√£ c·∫≠p nh·∫≠t theo y√™u c·∫ßu)
    const defaultData = {
        "Th·ª© 2": { 
            sang: {s:"Sinh", o:"ny"}, 
            trua: {s:"", o:"empty"},
            chieu: {s:"H√≥a", o:"ny"}, 
            toi: {s:"To√°n (Chung)", o:"both"} 
        },
        "Th·ª© 3": { 
            sang: {s:"H√≥a", o:"ny"}, 
            trua: {s:"", o:"empty"},
            chieu: {s:"To√°n (Chung)", o:"both"}, 
            toi: {s:"Sinh", o:"ny"} 
        },
        "Th·ª© 4": { 
            sang: {s:"To√°n (Chung)", o:"both"}, 
            trua: {s:"", o:"empty"},
            chieu: {s:"Sinh", o:"ny"}, 
            toi: {s:"H√≥a", o:"ny"} 
        },
        "Th·ª© 5": { 
            sang: {s:"Sinh", o:"ny"}, 
            trua: {s:"", o:"empty"},
            chieu: {s:"To√°n (Chung)", o:"both"}, 
            toi: {s:"H√≥a", o:"ny"} 
        },
        "Th·ª© 6": { 
            sang: {s:"To√°n (Chung)", o:"both"}, 
            trua: {s:"", o:"empty"},
            chieu: {s:"H√≥a", o:"ny"}, 
            toi: {s:"Sinh", o:"ny"} 
        },
        "Th·ª© 7": { 
            sang: {s:"H√≥a", o:"ny"}, 
            trua: {s:"", o:"empty"},
            chieu: {s:"Sinh", o:"ny"}, 
            toi: {s:"To√°n (Chung)", o:"both"} 
        },
        "CN": { 
            sang: {s:"Ngh·ªâ", o:"empty"}, 
            trua: {s:"", o:"empty"},
            chieu: {s:"Ngh·ªâ", o:"empty"}, 
            toi: {s:"Ngh·ªâ", o:"empty"} 
        }
    };

    const days = ["Th·ª© 2", "Th·ª© 3", "Th·ª© 4", "Th·ª© 5", "Th·ª© 6", "Th·ª© 7", "CN"];
    
    const sessions = [
        {key: "sang", label: "S√°ng", hint: "08:30 - 11:00"},
        {key: "trua", label: "Tr∆∞a", hint: "11:30 - 13:30"},
        {key: "chieu", label: "Chi·ªÅu", hint: "13:30 - 16:30"},
        {key: "toi", label: "T·ªëi", hint: "19:00 - 22:00"}
    ];

    // L·∫•y d·ªØ li·ªáu ho·∫∑c d√πng m·∫∑c ƒë·ªãnh
    let schedule = JSON.parse(localStorage.getItem('coupleTetScheduleV3')) || defaultData;
    
    let currentViewDayIndex = new Date().getDay() === 0 ? 6 : new Date().getDay() - 1;
    if (currentViewDayIndex < 0) currentViewDayIndex = 0; 

    function init() {
        initFlowers();
        renderTabs();
        renderTable();
        setInterval(updateTime, 1000);
        updateTime();
    }

    // Render Thanh Tabs
    function renderTabs() {
        const container = document.getElementById('day-tabs');
        container.innerHTML = '';
        
        days.forEach((day, index) => {
            const btn = document.createElement('div');
            btn.className = `tab-item ${index === currentViewDayIndex ? 'active' : ''}`;
            btn.innerText = day;
            btn.onclick = () => {
                currentViewDayIndex = index;
                renderTabs(); 
                renderTable(); 
            };
            container.appendChild(btn);
        });
    }

    // Render B·∫£ng Ch√≠nh
    function renderTable() {
        const tbody = document.getElementById('schedule-body');
        tbody.innerHTML = '';

        const currentDayName = days[currentViewDayIndex];
        const dayData = schedule[currentDayName] || {};

        sessions.forEach(sess => {
            let item = dayData[sess.key];
            if (!item) item = {s: "", o: "empty"}; 

            let anhContent = '';
            let emContent = '';
            let anhClass = '';
            let emClass = '';

            // Thay ƒë·ªïi icon trong logic render
            if (item.o === 'you') {
                anhContent = `<div class="subject-name">${item.s}</div><div class="status-icon">üå∏</div>`;
                anhClass = 'txt-anh';
                emContent = `<span class="txt-empty">---</span>`;
            } else if (item.o === 'ny') {
                anhContent = `<span class="txt-empty">---</span>`;
                emContent = `<div class="subject-name">${item.s}</div><div class="status-icon">‚ù§Ô∏è</div>`;
                emClass = 'txt-em';
            } else if (item.o === 'both') {
                anhContent = `<div class="subject-name">${item.s}</div>`;
                emContent = `<div class="subject-name">${item.s}</div>`;
                anhClass = 'txt-chung';
                emClass = 'txt-chung';
            } else {
                anhContent = `<span class="txt-empty">---</span>`;
                emContent = `<span class="txt-empty">---</span>`;
            }

            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td class="time-col">
                    ${sess.label}<br>
                    <span style="font-size:0.7rem; opacity:0.7; font-weight:normal">${sess.hint}</span>
                </td>
                <td class="content-col ${anhClass}" onclick="openModal('${sess.key}', 'you')">
                    <div class="cell-content">${anhContent}</div>
                </td>
                <td class="content-col ${emClass}" onclick="openModal('${sess.key}', 'ny')">
                    <div class="cell-content">${emContent}</div>
                </td>
            `;
            tbody.appendChild(tr);
        });
        
        checkReminder();
    }

    // Modal Handling
    function openModal(sessionKey, preferredOwner) {
        const currentDayName = days[currentViewDayIndex];
        const item = schedule[currentDayName][sessionKey] || {s:"", o:"empty"};

        document.getElementById('e-day').value = currentDayName;
        document.getElementById('e-session').value = sessionKey;
        document.getElementById('e-subject').value = item.s;
        
        let ownerToSet = item.o;
        if(item.o === 'empty') {
            ownerToSet = preferredOwner;
        }

        document.getElementById('e-owner').value = ownerToSet;
        document.getElementById('editModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('editModal').style.display = 'none';
    }

    function saveData() {
        const d = document.getElementById('e-day').value;
        const k = document.getElementById('e-session').value;
        const s = document.getElementById('e-subject').value;
        const o = document.getElementById('e-owner').value;

        if(!schedule[d]) schedule[d] = {};
        
        schedule[d][k] = {s: s, o: o};
        
        localStorage.setItem('coupleTetScheduleV3', JSON.stringify(schedule)); 
        renderTable();
        closeModal();
    }

    // Th·ªùi gian & Reminder
    function updateTime() {
        const now = new Date();
        document.getElementById('clock').innerText = now.toLocaleTimeString('vi-VN') + 
            " - " + now.toLocaleDateString('vi-VN', {weekday:'long', day:'numeric', month:'numeric'});
        
        if(now.getSeconds() === 0) checkReminder();
    }

    function checkReminder() {
        const now = new Date();
        const dayIdx = now.getDay() === 0 ? 6 : now.getDay() - 1;
        const currentDayData = schedule[days[dayIdx]];
        
        if(!currentDayData) return;

        const h = now.getHours();
        let msg = "Ch√∫c ng·ªß ngon! üí§";
        
        let activeSess = null;
        let timeLabel = "";

        if (h < 11) { activeSess = currentDayData.sang; timeLabel="S√°ng"; }
        else if (h < 14) { activeSess = currentDayData.trua; timeLabel="Tr∆∞a"; }
        else if (h < 18) { activeSess = currentDayData.chieu; timeLabel="Chi·ªÅu"; }
        else { activeSess = currentDayData.toi; timeLabel="T·ªëi"; }

        if (activeSess && activeSess.o !== 'empty') {
            msg = `ƒêang di·ªÖn ra (${timeLabel}): ${activeSess.s}`;
        } else {
             msg = "ƒêang r·∫£nh r·ªói... ü•∞";
        }

        document.getElementById('reminder').innerText = "üîî " + msg;
    }

    // Import/Export
    function copyData() {
        navigator.clipboard.writeText(JSON.stringify(schedule)).then(() => alert("ƒê√£ copy m√£ c·∫•u h√¨nh!"));
    }

    function pasteData() {
        const c = prompt("D√°n m√£ c·∫•u h√¨nh:");
        if(c) {
            try {
                const parsed = JSON.parse(c);
                schedule = parsed;
                localStorage.setItem('coupleTetScheduleV3', JSON.stringify(schedule));
                renderTable();
                alert("ƒê√£ c·∫≠p nh·∫≠t!");
            } catch(e) { alert("M√£ l·ªói!"); }
        }
    }

    function resetDefault() {
        if(confirm("X√≥a h·∫øt d·ªØ li·ªáu v·ªÅ m·∫∑c ƒë·ªãnh (L·ªãch m·ªõi)?")) {
            localStorage.removeItem('coupleTetScheduleV3');
            location.reload();
        }
    }

    // Hi·ªáu ·ª©ng hoa
    function initFlowers() {
        const c = document.getElementById('flower-container');
        for(let i=0; i<20; i++) {
            let f = document.createElement('div');
            f.className = 'flower';
            f.style.left = Math.random()*100 + '%';
            f.style.animationDuration = (Math.random()*5 + 5) + 's';
            f.style.animationDelay = Math.random()*5 + 's';
            c.appendChild(f);
        }
    }

    init();
</script>
</body>
</html>
