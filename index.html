<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Kh√¥ng Gian H·ªçc T·∫≠p - T·∫øt 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Be+Vietnam+Pro:wght@300;400;600;700;900&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<style>
    :root {
        /* B·ªô m√†u T·∫øt */
        --tet-bg-dark: #450a0a;  /* ƒê·ªè th·∫´m */
        --tet-red: #dc2626;      /* ƒê·ªè t∆∞∆°i */
        --tet-gold: #fbbf24;     /* V√†ng kim */
        --tet-cream: #fef3c7;    /* M√†u kem s√°ng */
        
        --glass-surface: rgba(40, 0, 0, 0.4);
        --glass-border: rgba(251, 191, 36, 0.3);
        --glass-highlight: rgba(251, 191, 36, 0.1);
        
        --text-main: #fffbeb;
        --text-muted: #fca5a5;
        
        --font-body: 'Be Vietnam Pro', sans-serif;
        --font-display: 'Dancing Script', cursive;
        --font-num: 'JetBrains Mono', monospace;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
        margin: 0;
        font-family: var(--font-body);
        background-color: var(--tet-bg-dark);
        background-image: 
            radial-gradient(circle at 20% 20%, #7f1d1d 0%, transparent 50%),
            radial-gradient(circle at 80% 80%, #991b1b 0%, transparent 50%);
        color: var(--text-main);
        min-height: 100vh;
        overflow-x: hidden;
        padding-bottom: 80px;
    }

    /* === HI·ªÜU ·ª®NG HOA R∆†I === */
    .flower-container {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: -1; overflow: hidden;
    }
    .flower {
        position: absolute; width: 15px; height: 15px;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23fecaca'%3E%3Cpath d='M12 2C9 7 4 9 2 12c5 2 7 7 10 10 3-5 8-7 10-10-5-2-7-7-10-10z'/%3E%3C/svg%3E");
        background-size: contain; opacity: 0.8;
    }
    .flower.yellow {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23fbbf24'%3E%3Cpath d='M12 2C9 7 4 9 2 12c5 2 7 7 10 10 3-5 8-7 10-10-5-2-7-7-10-10z'/%3E%3C/svg%3E");
    }

    /* === LAYOUT CH√çNH === */
    .container {
        max-width: 900px; margin: 0 auto; padding: 20px; position: relative; z-index: 10;
    }

    /* Header */
    header {
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 30px; flex-wrap: wrap; gap: 20px;
        background: rgba(0,0,0,0.2); border-radius: 20px; padding: 15px 25px;
        border: 1px solid var(--glass-border);
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    
    .logo-area h1 {
        font-family: var(--font-display); font-size: 2.2rem; margin: 0;
        background: linear-gradient(to right, #fcd34d, #f59e0b);
        -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        text-shadow: 0 2px 10px rgba(245, 158, 11, 0.3);
    }
    .greeting { font-size: 0.9rem; color: var(--text-muted); display: flex; align-items: center; gap: 8px; margin-top: 5px;}

    .user-actions { display: flex; gap: 10px; }
    .icon-btn {
        background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
        color: var(--tet-gold); width: 45px; height: 45px; border-radius: 12px;
        display: flex; align-items: center; justify-content: center; cursor: pointer;
        transition: 0.3s; font-size: 1.1rem;
    }
    .icon-btn:hover, .icon-btn.active { background: var(--tet-gold); color: #450a0a; transform: translateY(-3px); box-shadow: 0 0 15px var(--tet-gold); }

    /* === DASHBOARD ƒê·∫æM NG∆Ø·ª¢C === */
    .dashboard-grid {
        display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;
    }
    @media (max-width: 600px) { .dashboard-grid { grid-template-columns: 1fr; } }

    .widget-card {
        background: var(--glass-surface);
        backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        border: 1px solid var(--glass-border);
        border-radius: 20px; padding: 20px;
        position: relative; overflow: hidden; transition: 0.3s;
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    .widget-card:hover { transform: translateY(-5px); border-color: var(--tet-gold); }

    .widget-title { 
        font-size: 0.85rem; text-transform: uppercase; font-weight: 700; 
        color: var(--tet-gold); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; 
    }
    
    .countdown-flex { display: flex; gap: 15px; align-items: center; justify-content: center; }
    .count-block { text-align: center; }
    .count-val { font-size: 1.8rem; font-weight: 700; line-height: 1; font-family: var(--font-num); color: white; }
    .count-lbl { font-size: 0.7rem; color: var(--text-muted); margin-top: 4px; }
    
    .target-date { text-align: center; font-size: 0.75rem; color: rgba(255,255,255,0.5); margin-top: 10px; font-style: italic; }

    /* Quote Box */
    .quote-box {
        grid-column: 1 / -1;
        background: linear-gradient(90deg, rgba(251, 191, 36, 0.1), transparent);
        border-left: 4px solid var(--tet-gold);
        padding: 15px; border-radius: 12px; font-style: italic; color: #fde68a; font-size: 0.95rem;
        display: flex; align-items: center; gap: 15px;
    }

    /* === L·ªäCH H·ªåC === */
    .main-panel {
        background: rgba(40, 10, 10, 0.6);
        border: 1px solid var(--glass-border);
        border-radius: 24px; padding: 20px;
        backdrop-filter: blur(15px);
    }

    .tabs { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 15px; scrollbar-width: none; }
    .tabs::-webkit-scrollbar { display: none; }
    
    .tab {
        padding: 10px 20px; border-radius: 50px; background: rgba(255,255,255,0.1);
        color: rgba(255,255,255,0.7); font-weight: 600; font-size: 0.9rem; cursor: pointer; white-space: nowrap; transition: 0.3s;
    }
    .tab.active { background: var(--tet-gold); color: #450a0a; box-shadow: 0 0 15px rgba(251, 191, 36, 0.4); }

    /* Table */
    .schedule-table { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
    .schedule-table th { text-align: left; color: var(--tet-gold); font-size: 0.8rem; text-transform: uppercase; padding: 0 10px; opacity: 0.8; }
    
    .time-cell {
        background: rgba(0,0,0,0.2); border-radius: 15px 0 0 15px;
        padding: 15px; width: 80px; text-align: center; border: 1px solid var(--glass-border); border-right: none;
    }
    .t-main { font-weight: 700; font-size: 1.1rem; color: var(--tet-gold); font-family: var(--font-num); }
    .t-sub { font-size: 0.7rem; color: var(--text-muted); margin-top: 3px; }

    .content-cell {
        background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
        padding: 8px; position: relative; transition: 0.3s; cursor: pointer; vertical-align: middle;
    }
    .content-cell:hover { background: rgba(255,255,255,0.1); }
    .content-cell:last-child { border-radius: 0 15px 15px 0; }

    /* Th·∫ª M√¥n H·ªçc */
    .tag {
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        width: 100%; padding: 10px; border-radius: 12px; min-height: 50px; text-align: center;
        font-weight: 600; font-size: 0.95rem; transition: 0.2s;
    }
    /* M√†u s·∫Øc th·∫ª */
    .tag-anh { background: rgba(59, 130, 246, 0.2); color: #93c5fd; border: 1px solid rgba(59, 130, 246, 0.4); }
    .tag-em { background: rgba(236, 72, 153, 0.2); color: #f9a8d4; border: 1px solid rgba(236, 72, 153, 0.4); }
    .tag-both { 
        background: linear-gradient(135deg, rgba(220, 38, 38, 0.3), rgba(251, 191, 36, 0.3));
        color: #fde68a; border: 1px solid var(--tet-gold); box-shadow: 0 0 10px rgba(251, 191, 36, 0.2);
    }
    .tag-empty { opacity: 0.3; font-size: 1.5rem; line-height: 0; color: #666; }

    /* === CH·∫æ ƒê·ªò T·∫¨P TRUNG === */
    .focus-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #000; z-index: 9999; display: none;
        flex-direction: column; align-items: center; justify-content: center;
    }
    .focus-overlay.active { display: flex; animation: fadeIn 0.5s; }
    .focus-clock { font-size: 6rem; font-weight: 900; font-family: var(--font-num); color: var(--tet-gold); }
    .focus-msg { font-size: 1.5rem; color: white; margin-top: 20px; font-family: var(--font-display); }
    .btn-exit-focus { margin-top: 50px; border: 1px solid #333; background: transparent; color: #666; padding: 10px 30px; border-radius: 50px; cursor: pointer; transition: 0.3s; }
    .btn-exit-focus:hover { color: var(--tet-gold); border-color: var(--tet-gold); }

    /* === MODAL & TOAST === */
    .toast {
        position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(50px);
        background: var(--tet-gold); color: #450a0a; padding: 12px 25px; border-radius: 30px; font-weight: bold;
        opacity: 0; transition: 0.4s; pointer-events: none; z-index: 2000; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

    .modal-wrap {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8);
        backdrop-filter: blur(5px); z-index: 1000; display: none; align-items: center; justify-content: center;
    }
    .modal-box {
        width: 90%; max-width: 400px; background: #2a0a0a; border: 2px solid var(--tet-gold);
        padding: 30px; border-radius: 20px; box-shadow: 0 0 50px rgba(220, 38, 38, 0.4);
    }
    .inp { width: 100%; background: #450a0a; border: 1px solid #7f1d1d; color: white; padding: 15px; border-radius: 10px; margin-bottom: 15px; font-size: 1rem; outline: none; }
    .inp:focus { border-color: var(--tet-gold); }
    .btn-save { width: 100%; background: var(--tet-gold); color: #450a0a; padding: 15px; border-radius: 10px; border: none; font-weight: 900; cursor: pointer; font-size: 1rem; }

    /* ·∫®n YouTube Iframe */
    #yt-player-container { position: absolute; top: -9999px; left: -9999px; opacity: 0; pointer-events: none; }

</style>
</head>
<body>

<div class="flower-container" id="flowers"></div>

<div id="yt-player-container"></div>

<div class="focus-overlay" id="focusOverlay">
    <div class="focus-clock" id="focus-clock">00:00</div>
    <div class="focus-msg">"C·∫ßn c√π b√π th√¥ng minh - C·ªë l√™n!"</div>
    <div style="margin-top:20px; color:#888; font-size: 0.9rem;">Ch·∫ø ƒë·ªô T·∫≠p Trung - T·∫øt 2026</div>
    <button class="btn-exit-focus" onclick="toggleFocus()">Tho√°t Ch·∫ø ƒê·ªô</button>
</div>

<div class="toast" id="toast">Th√¥ng b√°o h·ªá th·ªëng</div>

<div class="container animate__animated animate__fadeIn">
    <header>
        <div class="logo-area">
            <h1>T·∫øt H·ªçc T·∫≠p 2026</h1>
            <div class="greeting" id="greeting"><i class="fas fa-sun"></i> Ch√†o bu·ªïi s√°ng!</div>
        </div>
        <div class="user-actions">
            <div class="icon-btn" onclick="toggleFocus()" title="T·∫≠p trung"><i class="fas fa-eye"></i></div>
            <div class="icon-btn" onclick="toggleMusic()" title="Nh·∫°c Lofi Ng·∫´u Nhi√™n" id="music-btn"><i class="fas fa-music"></i></div>
            <div class="icon-btn" onclick="copyData()" title="Sao l∆∞u"><i class="fas fa-save"></i></div>
            <div class="icon-btn" onclick="pasteData()" title="Kh√¥i ph·ª•c"><i class="fas fa-file-import"></i></div>
        </div>
    </header>

    <div class="dashboard-grid">
        <div class="widget-card animate__animated animate__fadeInUp" style="animation-delay: 0.1s;">
            <div class="widget-title"><i class="fas fa-star"></i> T·∫øt B√≠nh Ng·ªç 2026</div>
            <div class="countdown-flex">
                <div class="count-block"><div class="count-val" id="t-d">00</div><div class="count-lbl">Ng√†y</div></div>
                <div class="count-block"><div class="count-val" id="t-h">00</div><div class="count-lbl">Gi·ªù</div></div>
                <div class="count-block"><div class="count-val" id="t-m">00</div><div class="count-lbl">Ph√∫t</div></div>
            </div>
            <div class="target-date">M·ª•c ti√™u: 17/02/2026</div>
        </div>

        <div class="widget-card animate__animated animate__fadeInUp" style="animation-delay: 0.2s;">
            <div class="widget-title"><i class="fas fa-graduation-cap"></i> Thi THPT Qu·ªëc Gia</div>
            <div class="countdown-flex">
                <div class="count-block"><div class="count-val" id="e-d">000</div><div class="count-lbl">Ng√†y</div></div>
                <div class="count-block"><div class="count-val" id="e-h">00</div><div class="count-lbl">Gi·ªù</div></div>
                <div class="count-block"><div class="count-val" id="e-m">00</div><div class="count-lbl">Ph√∫t</div></div>
            </div>
            <div class="target-date">Ng√†y thi: 11/06/2026</div>
        </div>

        <div class="quote-box animate__animated animate__fadeInUp" style="animation-delay: 0.3s;">
            <i class="fas fa-quote-left" style="color:var(--tet-gold)"></i>
            <span id="daily-quote">V·∫°n s·ª± kh·ªüi ƒë·∫ßu nan, gian nan ƒë·ª´ng c√≥ n·∫£n.</span>
        </div>
    </div>

    <div class="main-panel animate__animated animate__fadeInUp" style="animation-delay: 0.4s;">
        <div class="tabs" id="day-tabs"></div>
        
        <table class="schedule-table">
            <thead>
                <tr>
                    <th style="width:100px">Th·ªùi Gian</th>
                    <th>üå∏ Anh</th>
                    <th>‚ù§Ô∏è Em</th>
                </tr>
            </thead>
            <tbody id="schedule-body"></tbody>
        </table>
    </div>

    <div style="text-align:center; margin-top:30px; opacity:0.6; font-size:0.8rem;">
        <span style="cursor:pointer; color:var(--text-muted);" onclick="resetDefault()">[Kh√¥i Ph·ª•c M·∫∑c ƒê·ªãnh]</span>
    </div>
</div>

<div class="modal-wrap" id="editModal">
    <div class="modal-box animate__animated animate__zoomIn">
        <h3 style="color:var(--tet-gold); margin-top:0; text-align:center">C·∫≠p Nh·∫≠t L·ªãch Tr√¨nh</h3>
        <input type="hidden" id="e-day"><input type="hidden" id="e-session">
        
        <label style="display:block; color:#aaa; margin-bottom:5px; font-size:0.8rem">N·ªòI DUNG / M√îN H·ªåC</label>
        <input type="text" class="inp" id="e-subject" placeholder="VD: To√°n H√¨nh, VƒÉn...">
        
        <label style="display:block; color:#aaa; margin-bottom:5px; font-size:0.8rem">NG∆Ø·ªúI TH·ª∞C HI·ªÜN</label>
        <select class="inp" id="e-owner">
            <option value="empty">Tr·ªëng / Ngh·ªâ</option>
            <option value="you">Anh (H·ªçc ri√™ng)</option>
            <option value="ny">Em (H·ªçc ri√™ng)</option>
            <option value="both">H·ªçc Chung (ƒê√¥i)</option>
        </select>
        
        <button class="btn-save" onclick="saveData()">L∆ØU L·∫†I</button>
        <button style="width:100%; background:transparent; border:none; color:#aaa; padding:10px; cursor:pointer; margin-top:5px;" onclick="closeModal()">ƒê√≥ng H·ªôp Tho·∫°i</button>
    </div>
</div>

<script>
    /* ================= 1. C·∫§U H√åNH NH·∫†C LOFI (YOUTUBE) ================= */
    // Danh s√°ch Video ID c·ªßa c√°c lu·ªìng Lofi Live ho·∫∑c Video d√†i (Kh√¥ng qu·∫£ng c√°o c√†ng t·ªët)
    const lofiVideos = [
        "jfKfPfyJRdk", // Lofi Girl Live
        "5qap5aO4i9A", // Lofi Hip Hop Radio
        "4xDzrJKXOOY", // Synthwave Radio (ƒê·ªïi gi√≥)
        "F_N5iaM1vK8"  // Nh·∫°c Lofi Vi·ªát Chill
    ];
    let isPlaying = false;
    let player = null;

    // Load YouTube API
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    function onYouTubeIframeAPIReady() {
        // API Ready - ch·ªù user click play
    }

    function toggleMusic() {
        const btn = document.getElementById('music-btn');
        if (!isPlaying) {
            // B·∫ÆT ƒê·∫¶U PH√ÅT
            const randomVid = lofiVideos[Math.floor(Math.random() * lofiVideos.length)];
            
            if(player) {
                player.loadVideoById(randomVid);
            } else {
                player = new YT.Player('yt-player-container', {
                    height: '1', width: '1', // ·∫®n player
                    videoId: randomVid,
                    playerVars: { 'autoplay': 1, 'controls': 0, 'loop': 1 },
                    events: {
                        'onReady': (event) => event.target.playVideo()
                    }
                });
            }
            
            isPlaying = true;
            btn.classList.add('active');
            btn.innerHTML = '<i class="fas fa-volume-up"></i>';
            showToast("ƒêang ph√°t nh·∫°c Lofi ng·∫´u nhi√™n...");
        } else {
            // D·ª™NG PH√ÅT
            if(player) player.stopVideo();
            isPlaying = false;
            btn.classList.remove('active');
            btn.innerHTML = '<i class="fas fa-music"></i>';
            showToast("ƒê√£ t·∫Øt nh·∫°c.");
        }
    }

    /* ================= 2. D·ªÆ LI·ªÜU L·ªäCH (GI·ªÆ NGUY√äN) ================= */
    const configEm = {
        "Th·ª© 2": ["Sinh", "H√≥a", "To√°n"],
        "Th·ª© 3": ["H√≥a", "To√°n", "Sinh"],
        "Th·ª© 4": ["To√°n", "Sinh", "H√≥a"],
        "Th·ª© 5": ["Sinh", "To√°n", "H√≥a"],
        "Th·ª© 6": ["To√°n", "H√≥a", "Sinh"],
        "Th·ª© 7": ["H√≥a", "Sinh", "To√°n"],
        "CN":    ["Ngh·ªâ", "Ngh·ªâ", "Ngh·ªâ"]
    };
    const configAnh = {
        "Th·ª© 2": ["To√°n", "VƒÉn", "S·ª≠"],
        "Th·ª© 3": ["To√°n", "VƒÉn", "S·ª≠"],
        "Th·ª© 4": ["To√°n", "VƒÉn", "S·ª≠"],
        "Th·ª© 5": ["To√°n", "VƒÉn", "S·ª≠"],
        "Th·ª© 6": ["To√°n", "VƒÉn", "S·ª≠"],
        "Th·ª© 7": ["To√°n", "VƒÉn", "S·ª≠"],
        "CN":    ["GDKT-PL", "GDKT-PL", "2 ƒê·ªÅ ƒêGNL & V-SAT"] 
    };
    const monTruaAnh = "ƒê·ªÄ ƒêGNL";
    const days = ["Th·ª© 2", "Th·ª© 3", "Th·ª© 4", "Th·ª© 5", "Th·ª© 6", "Th·ª© 7", "CN"];
    const sessions = [
        {key: "sang", label: "S√ÅNG", time: "08:00"},
        {key: "trua", label: "TR∆ØA", time: "12:00"},
        {key: "chieu", label: "CHI·ªÄU", time: "14:00"},
        {key: "toi", label: "T·ªêI", time: "19:00"}
    ];

    // C√¢u n√≥i ƒë·ªông l·ª±c ti·∫øng Vi·ªát
    const quotes = [
        "VƒÉn √¥n v√µ luy·ªán.",
        "Tr√™n b∆∞·ªõc ƒë∆∞·ªùng th√†nh c√¥ng kh√¥ng c√≥ d·∫•u ch√¢n c·ªßa k·∫ª l∆∞·ªùi bi·∫øng.",
        "H·ªçc, h·ªçc n·ªØa, h·ªçc m√£i.",
        "M·ª•c ti√™u 27 ƒëi·ªÉm ƒëang ch·ªù ph√≠a tr∆∞·ªõc!",
        "Gian nan kh·ªï luy·ªán m·ªõi th√†nh t√†i.",
        "T·∫øt vui nh∆∞ng kh√¥ng qu√™n nhi·ªám v·ª•!"
    ];

    /* ================= 3. LOGIC X·ª¨ L√ù CH√çNH ================= */
    const examDate = new Date('2026-06-11T00:00:00').getTime();
    const tetDate = new Date('2026-02-17T00:00:00').getTime(); // M√πng 1 T·∫øt B√≠nh Ng·ªç

    function updateCountdowns() {
        const now = new Date().getTime();
        renderTimer(tetDate - now, 't');
        renderTimer(examDate - now, 'e');
    }

    function renderTimer(distance, prefix) {
        if(distance < 0) distance = 0;
        const d = Math.floor(distance / (1000 * 60 * 60 * 24));
        const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        
        document.getElementById(`${prefix}-d`).innerText = d < 10 ? '0'+d : d;
        document.getElementById(`${prefix}-h`).innerText = h < 10 ? '0'+h : h;
        document.getElementById(`${prefix}-m`).innerText = m < 10 ? '0'+m : m;
    }

    // Logic t·∫°o data
    function generateDefaultData() {
        let data = {};
        days.forEach(day => {
            data[day] = {};
            let subEm = configEm[day] || ["","",""];
            let subAnh = configAnh[day] || [];
            let aIdx = 0;
            
            ["sang", "chieu", "toi"].forEach((key, idx) => {
                let sEm = subEm[idx];
                let sAnh = "";
                let owner = "empty";
                if (aIdx < subAnh.length) { sAnh = subAnh[aIdx]; aIdx++; }

                if (sAnh && sEm && sAnh !== "Ngh·ªâ" && sEm !== "Ngh·ªâ") {
                    if (sAnh === sEm) {
                        owner = "both";
                        if (sAnh === "To√°n") sAnh = "To√°n (Chung)";
                    } else owner = "split";
                } else if (sAnh && sAnh !== "Ngh·ªâ") owner = "you";
                else if (sEm && sEm !== "Ngh·ªâ") owner = "ny";

                if(owner === "split") data[day][key] = {s: sAnh + "|" + sEm, o: "split"};
                else if(owner === "both") data[day][key] = {s: sAnh, o: "both"};
                else if(owner === "you") data[day][key] = {s: sAnh, o: "you"};
                else if(owner === "ny") data[day][key] = {s: sEm, o: "ny"};
                else data[day][key] = {s: "Tr·ªëng", o: "empty"};
            });
            
            if(day === "CN") data[day]["trua"] = {s: "Tr·ªëng", o: "empty"};
            else data[day]["trua"] = {s: monTruaAnh, o: "you"};
        });
        return data;
    }

    let schedule = JSON.parse(localStorage.getItem('Tet2026_Data')) || generateDefaultData();
    let currentIdx = new Date().getDay() === 0 ? 6 : new Date().getDay() - 1;
    if(currentIdx < 0) currentIdx = 0;

    // Render UI
    function init() {
        createFlowers();
        renderTabs();
        renderTable();
        updateGreeting();
        setInterval(updateCountdowns, 1000);
        setInterval(updateClockFocus, 1000);
        updateCountdowns();
        document.getElementById('daily-quote').innerText = quotes[Math.floor(Math.random()*quotes.length)];
    }

    function renderTabs() {
        const c = document.getElementById('day-tabs');
        c.innerHTML = '';
        days.forEach((d, i) => {
            let b = document.createElement('div');
            b.className = `tab ${i === currentIdx ? 'active' : ''}`;
            b.innerText = d;
            b.onclick = () => { currentIdx = i; renderTabs(); renderTable(); };
            c.appendChild(b);
        });
    }

    function renderTable() {
        const body = document.getElementById('schedule-body');
        body.innerHTML = '';
        const dayData = schedule[days[currentIdx]] || {};
        
        sessions.forEach(sess => {
            const item = dayData[sess.key] || {s: "...", o: "empty"};
            let htmlA = '', htmlB = '';
            
            if(item.o === 'split') {
                let p = item.s.split('|');
                htmlA = `<div class="tag tag-anh">${p[0]}</div>`;
                htmlB = `<div class="tag tag-em">${p[1]}</div>`;
            } else if (item.o === 'both') {
                htmlA = `<div class="tag tag-both">H·ªçc Chung: ${item.s}</div>`;
                htmlB = `<div class="tag tag-both">H·ªçc Chung: ${item.s}</div>`;
            } else if (item.o === 'you') {
                htmlA = `<div class="tag tag-anh">${item.s}</div>`;
                htmlB = `<div class="tag tag-empty">&middot;</div>`;
            } else if (item.o === 'ny') {
                htmlA = `<div class="tag tag-empty">&middot;</div>`;
                htmlB = `<div class="tag tag-em">${item.s}</div>`;
            } else {
                htmlA = `<div class="tag tag-empty">&middot;</div>`;
                htmlB = `<div class="tag tag-empty">&middot;</div>`;
            }

            let tr = document.createElement('tr');
            tr.innerHTML = `
                <td class="time-cell">
                    <div class="t-main">${sess.time}</div>
                    <div class="t-sub">${sess.label}</div>
                </td>
                <td class="content-cell" onclick="openModal('${sess.key}', 'you')">${htmlA}</td>
                <td class="content-cell" onclick="openModal('${sess.key}', 'ny')">${htmlB}</td>
            `;
            body.appendChild(tr);
        });
    }

    // Modal & Actions
    const modal = document.getElementById('editModal');
    function openModal(key, pref) {
        const d = days[currentIdx];
        const item = schedule[d][key] || {s:"", o:"empty"};
        document.getElementById('e-day').value = d;
        document.getElementById('e-session').value = key;
        let s = item.s;
        if(item.o === 'split') s = s.replace('|', ' & ');
        document.getElementById('e-subject').value = s;
        let o = item.o === 'empty' ? pref : (item.o === 'split' ? 'both' : item.o);
        document.getElementById('e-owner').value = o;
        modal.style.display = 'flex';
    }
    function closeModal() { modal.style.display = 'none'; }
    function saveData() {
        const d = document.getElementById('e-day').value;
        const k = document.getElementById('e-session').value;
        const s = document.getElementById('e-subject').value;
        const o = document.getElementById('e-owner').value;
        if(!schedule[d]) schedule[d] = {};
        schedule[d][k] = {s: s, o: o};
        localStorage.setItem('Tet2026_Data', JSON.stringify(schedule));
        renderTable(); closeModal(); showToast("ƒê√£ l∆∞u d·ªØ li·ªáu!");
    }

    // Utils
    function toggleFocus() {
        const el = document.getElementById('focusOverlay');
        el.classList.toggle('active');
        if(el.classList.contains('active')) {
            if(document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
        } else {
            if(document.exitFullscreen) document.exitFullscreen();
        }
    }
    
    function updateClockFocus() {
        const now = new Date();
        document.getElementById('focus-clock').innerText = now.toLocaleTimeString('vi-VN', {hour: '2-digit', minute:'2-digit'});
    }

    function updateGreeting() {
        const h = new Date().getHours();
        let g = "Ch√†o bu·ªïi s√°ng!";
        let i = "sun";
        if(h >= 12 && h < 18) { g = "Ch√†o bu·ªïi chi·ªÅu!"; i = "cloud-sun"; }
        else if(h >= 18) { g = "Ch√†o bu·ªïi t·ªëi!"; i = "moon"; }
        document.getElementById('greeting').innerHTML = `<i class="fas fa-${i}"></i> ${g}`;
    }

    function createFlowers() {
        const c = document.getElementById('flowers');
        for(let i=0; i<30; i++) {
            let f = document.createElement('div');
            f.className = Math.random() > 0.5 ? 'flower' : 'flower yellow';
            f.style.left = Math.random() * 100 + '%';
            f.style.top = -10 + 'px';
            // Animation th·ªß c√¥ng ƒë∆°n gi·∫£n qua CSS
            f.style.transition = `top ${Math.random()*5+5}s linear, transform 5s`;
            c.appendChild(f);
            
            // Animation loop
            animateFlower(f);
        }
    }
    
    function animateFlower(f) {
        const duration = Math.random() * 5000 + 5000;
        const startX = Math.random() * window.innerWidth;
        
        f.animate([
            { transform: `translate(${startX}px, -20px) rotate(0deg)`, opacity: 0 },
            { opacity: 1, offset: 0.1 },
            { transform: `translate(${startX + Math.random()*100 - 50}px, ${window.innerHeight}px) rotate(360deg)`, opacity: 0 }
        ], {
            duration: duration,
            iterations: Infinity,
            delay: Math.random() * 5000
        });
    }

    function showToast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
    }
    
    function copyData() { navigator.clipboard.writeText(JSON.stringify(schedule)); showToast("ƒê√£ sao ch√©p d·ªØ li·ªáu!"); }
    function pasteData() {
        let v = prompt("D√°n m√£ d·ªØ li·ªáu:");
        if(v) {
            try { schedule = JSON.parse(v); localStorage.setItem('Tet2026_Data', v); renderTable(); showToast("ƒê√£ kh√¥i ph·ª•c d·ªØ li·ªáu!"); }
            catch(e) { alert("L·ªói d·ªØ li·ªáu!"); }
        }
    }
    function resetDefault() {
        if(confirm("B·∫°n c√≥ ch·∫Øc mu·ªën ƒë·∫∑t l·∫°i?")) { localStorage.removeItem('Tet2026_Data'); location.reload(); }
    }

    init();
</script>
</body>
</html>
